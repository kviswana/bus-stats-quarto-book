# Exploring Relationships through Scatterplots

This chapter covers the basics of generating and interpreting scatterplots. charts and interpreting

The term *statistics* often conjures up thoughts of numerical computations. However, before we perform various co mputations, we often get a feel for the data and the underlying patterns by first visualizing the data. In this course we will use only a few standard plots to communicate essential statistical ideas. 

In fact, use a single function -- *point_plot* -- to generate all of our plots. Although R offers numerous, sophisticated plotting features to plot almost anything we can imagine, we will keep things simple and focus only on what we need to support the concepts that our course covers.

## Learning outcomes {.unnumbered}

### After working though this chapter, you will be able to: {.unnumbered}

**Demonstrate these outcomnes related to interpreting scatterplots:**

  - given a scatterplot of two numeric variables with the plot's axes labeled, explain precisely what determines the location of a given point
  - given a scatterplot of two numeric variables, the data frame on which it is based, and a specific point on the plot, identify the corresponding row in the data frame
  - given a scatterplot of two numeric variables, the data frame on which it is based, and a specific row in the data frame,  identify the corresponding point on the plot
  - given a scatterplot of one numeric variable on the y-axis against a categorical variable on the x-axis, explain how many distinct possible values exist for the x-axis
  - given a scatterplot one numeric variable on the y-axis against a categorical variable on the x-axis, explain the speific appearance of the points along the x-axis for each of the category levels
  - explain why the points are jittered along the x-axis when the x-axis has a categorical variable
  - Given a scatterplot of a numeric variable on the y-axis and a caregorical variable on the x-axis, identify a pair of points that would have overlapped if not for jittering
   
**Demonstrate these outcomnes related to generating scatterplots using R data frames:**

  - use the point_plot function to
    - generate a scatterplot of two numeric variables
    - generate a scatterplot of one numerical variable on the y-axis against a categorical variable on the x-axis
    - generate a scatterplot of numeric variables on both axes with the points colored based on a third variable
    - describe a tilde-expression (a model expression)
    - given a tilde-expression with one variable on either side of the tilde, state how they relate to the plot axes
    - given a tilde expression with two variables on the right of the tilde, explain the mappings of the elements of the tidle expression to the elements of the plot

**Demonstrate these outconmes related to relationships between variables:**

  - Given a scatterplot of two variables, determine if they have a positive or negative relationship or if they are unrelated.
  - Clearly explain a visual procedure you would adopt to determine the type of relationship between two numerical variables 
  
## Plotting the relationship between two numerical variables

The *point_plot()* function that we will rely on for plots in this course lives in the *LSTbook* package. We will be using the *LSTextra*s package. Once we load the *LSTextras* package (which in turn loads the *LSTbook* package and all its dependencies), the *point_plot()* function becomes available for us to use. 

Let us first look at the *price_demand* data frame that is built into the *LSTbook* package.

A hypothetical company has gathered data for a single product. Over time, and across very similar sales areas, the company has charged different prices for the same product, It has recorded the monthly sales for each price. The dataset *price_demand* contains the price and the corresponding sales quantities. We would like to study if the two variables *price* and *sales_qty* are related in any way. 

First let us see some rows from the dataset.



```{r}
#| echo: false
#| label: tbl-price-demand
#| tbl-cap: "Price Demand data (first 15 rows)"

knitr::kable(head(price_demand, 15), booktabs = TRUE) |> kableExtra::kable_styling(latex_options = "hold_position")
```

The full dataset has 500 rows. With so many rows, we cannot easily get a handle on the overall pattern by looking at the data directly. Visualizing the data might help us. We will do several things in this section:
- generate the plot using R code
- understand how each element of the plot is related to the original dataset
- understand the various elements of the code so that you can use similar code to generate plots that you many need
- interpret the plot

The code and the plot appear below. For now, ignore the code. We will discuss it in detail after analyzing the plot itself.

```{r}
#| echo: true
#| label: fig-price-demand
#| fig-cap: "Price demand relationship"
price_demand |> 
  point_plot(sales_qty ~ price)
```

@fig-price-demand shows the relationship between *price* and *sales_qty* -- the two variables in the data frame. Note the following about the plot:

- The plot has two axes -- the x-axis along the width and the y-axis along tbe height. 
- The plot shows thge values of price on the x-axis and the values of sales_qty on the y-axis.
- If you take any single point on the plot, you can drop a vertical line from the point to the x-axis and the point where it intersects the x-axis is the *price* corresponding to the point.
- Similarly, if you draw a horizontal line from the point to intersect the y-axis, you get the *sales_qty* corresponding to that point.
- Each point of the plot corresponds to one row of the dataset. So how many points are on the plot? 500, since the dataset has 500 rows. 
- Thus given a point on the plot, we should be able to identify a corresponding row of the data frame
- Given a row of the data frame, we should be able to identify a corresponding point on the plot.

### Finding the point corresponding to a row of the data frame

Let us now try to find the point on the plot corrresponding to the first row in @fig-price-demand.

The first row of the data frame has *price = 11.8* and *sales_qty = 1260*. Therefore, we can find the point by drawing a vertical line from 11.8 on the x-axis to intersect a horizontal line from 1260 on the y-axis. @fig-first-row-price-demand-on-plot illustrates this. We have highlighted the point by enlarging it.

![Finding the first row of the *price_demand* data frame on the plot: *price = 11.8*, *sales_qty =  1260*](../../images/fig-first-row-price-demand-on-plot.png){#fig-first-row-price-demand-on-plot width=70% fig-align="center"}

Similarly, let us locate the point corresponding to row 11 (*price = 13.3*, *sales_qty = 1170*).

following the same approach we arrive at @fig-eleventh-row-price-demand-on-plot.

![Finding the eleventh row of the *price_demand* data frame on the plot: *price = 13.3*, *sales_qty = 1170*](../../images/fig-eleventh-row-price-demand-on-plot.png){#fig-eleventh-row-price-demand-on-plot width=70% fig-align="center"}

### Finding the *price* and *sales_qty* corresponding to a point on the plot

We can reverse the above process to find the variable values (and hence the actual row) corresponding to a point on the plot. We will simply drop a vertical line from the point down to the x-axis to get the *price* and draw a horizontal line from the point to the y-axis to determine the *sales_qty*. The figure will look similar to the prior two figures.

### Dissecting the code

@fig-first-point-plot-code decodes the various elements of the code that we used to generate out first point plot in @fig-price-demand. We see that we pass the data frame *price_demand* to the *point_plot* function through the *pipe* operator. We add the tilde expression for the plot as an additional argument.

@fig-basic-tilde-expression shows us that the *point_plot* function maps the variable on the left of the tilde operator to the y-axis of the plot and maps the variable to the right of the tilde expression to the x-axis of the plot.

![Passing the *price_demand* data frame as argument to the *point_plot* function through the pipe operator](../../images/fig-first-point-plot-code.png){#fig-first-point-plot-code width=70% fig-align="center"}

![Using a tilde expression to map variables to the axes](../../images/fig-basic-tilde-expression.png){#fig-basic-tilde-expression width=70% fig-align="center"}

### Interpreting the plot

@fig-price-demand-2 repeats the plot of *price* versus *sales_qty*. 

```{r}
#| echo: true
#| label: fig-price-demand-2
#| fig-cap: "Price demand relationship (again)"
price_demand |> 
  point_plot(sales_qty ~ price)
```

We can see a clear trend showing that, in general, higher prices correspond to lower values of sales quantity. 

To be sure, this is only a trend and not a strict rule. That is, given any two points, we do not have a guarantee that the point with the higher price will always have a lower sales quantity. However, this will be true for most of the pairs of points. @fig-scatter-with-line-segments-1 illustrates this with some randomly selected pairs of points. We see that most of the lines point down and to the right -- meaning that for most pairs of points, the one with higher *price* has a lower *sales_qty*. However, we also see a few examples where the opposite is true. 

This is why we only calls this a *trend* and not a strict rule about the relationship between price and sales_qty.

![Line segments connecting some pairs of points showing that for most pairs of points the point with higher price has lower sales_qty](../../images/fig-scatter-with-line-segments-1.png){#fig-scatter-with-line-segments-1 width=70% fig-align="center"}

### Positive and negative relationships

In general, when we discuss the relationship between two numerical variables, if the general trend is that higher values of one correspond to higher values of the other, then we have a positive relationship. On the other hand, is higher values of one variable correspond to lower values of the other then we have a negative relationship.

What kind of relationship does @fig-price-demand-2 show -- positive or negative?

You got it right if you said *negative* -- higher values of *price* correspond to lower values of *sales_qty*.

@fig-advertising-sales-channel-1 shows two positively correlated variables. Here, higher values of one variable are generally related to higher values of the other. We used the *advertising_sales_channel* data frame for this plot.


```{r}
#| echo: true
#| label: fig-advertising-sales-channel-1
#| fig-cap: "Weekly sales and advertising spend have a positive relationship -- higher advertising generally has higher weekly sales"
advertising_sales_channel |> 
  point_plot(weekly_sales_k ~ advertising_spend_k)
```

The data frame *returns_dpo* contains hypothetical data on various firms' daily stock returns and the number of days they take to pay their suppliers. @fig-returns-dpo-1 shows the relationship between these variables. We cannot spot any trend. Higher or lower values of one variable do not indicate higher or lower values of the other. Hence there is neither a positive relationship nor a negative one.

```{r}
#| echo: true
#| label: fig-returns-dpo-1
#| fig-cap: "Days payment outstanding (dpo) does not have a relationship to the daily stock return"
returns_dpo |> 
  point_plot(daily_return ~ dpo)
```

### Putting a number on the relationship: The correlation coefficient 

Thus far, we have been talking about relationships between variables. Exact sciences like mathematics and statistics like to be precise and assign numbers where possible. Statistics commonly uses the *correlation coefficient* to quantify the relationship between two numerical variables. This section just introduces the *correlation coefficient* and shows you how to compute it using R. We will get into the mechanics of the actual computation later in the book.

The correlation coefficient can take a value between -1 and +1. A value of 0 signifies a complete absence of relationship. -1 signifies a perfect negative correlation and +1 signifies a perfact positive correlation. We discuss these ideas below.

We look at some examples now. Revisiting the *price_demand* data frame, let us use R to compute the correlation coefficient between the variables *price* and *sales_qty*. 

```{r}
price_demand |> 
  summarize(price_sales_qty_correlation = cor(price, sales_qty))
```

We are computing a summary and hence use the *summarize* function (see @sec-summarize-function). Since the summary we are computing now is the correlation coefficient, we use the *cor* function within the *summarize* function. We have chosen to call the comoputed result *price_sales_qty_correlation*. We could have named it anything we wanted, but chose the sensible approach of giving it a meaningul name.

@fig-price-demand had already shown us the negative relationship between  *price* and *sales_qty*. The correlation confirms it, ... and makes it more precise.

Let us compute the correlation coefficient between advertising spend and the weekly sales from the *advertising_sales_channel* data frame. From @fig-advertising-sales-channel-1 we saw that these two variables are positively related. Let us see what the correlation coefficient says.

```{r}
advertising_sales_channel |> 
  summarize(ad_sales_corr = cor(advertising_spend_k, weekly_sales_k))
```

Sure enough, we see a positive correlation coefficient.

### Perfect correlation

Consider @fig-price-demand-3 showing strong, but imperfect, correlation.

```{r}
#| echo: true
#| label: fig-price-demand-3
#| fig-cap: "Price and sales_qty are not perfectly correlated -- correlation coefficient is -0.75 "
price_demand |> 
  point_plot(sales_qty ~ price)
```

We have already established that *price* and *sales_qty* are negatively related. That is, there is a general pattern that higher values of *price* have lower values of *sales_qty*.

In @fig-price-demand-3, if we look only at the points corresponding to a particular value of *price*, say 13, the points along this vertical line range from approximately 1100 to 1320. That is, given a value of *price*, we cannot be sure about the exact value of the corresponding value of *sales_qty*. However, knowing  *price* does give us some idea about *sale_qty*. This shows relationship, but not perfect correlation.

When the correlation coefficient is +1 or -1, we have perfect correlation. In this case, knowing the value of one variable enables us to precisely know the value of the other variable as well. This happens when all the points lie on a straight line instead of being dispersed as a cloud as in @fig-price-demand-3.

![Perfect correlation arises when all the points lie perfectly on a straight line -- the variables in this plot have a corelation coefficient of +1](../../images/fig-production-cost-units-produced.png){#fig-production-cost-units-produced width=70% fig-align="center"}

@fig-production-cost-units-produced shows a situation when all points lie on a perfect straight line. In this case, given a value for one variable, we can determine exactly the value of the other. We can determine it visually or by plugging the value of the known variable into the following equation and calculating the value of the other variable.

```{r}
#| eval: FALSE
total_cost = 10000 + 45*units_produced
```

In @fig-production-cost-units-produced the line slopes upward as it goes from left to right. WHen the line on which all points fall slopes down as it goes right, the correlation is still perfect, but the line slopes down as it goes to the right and so we have a correlation coefficien of -1.

### How the point cloud looks for various correlation coefficients

@fig-various-corr-coeffs shows the point plots for various values of correlation coefficients between -1 and +1. 

![Point plots for various correlation-coefficients (r)](../../images/fig-various-corr-coeffs.png){#fig-various-corr-coeffs width=70% fig-align="center"}

You can see the following:
- in the plot wigth correlation coefficient = -1 (r = -1), the points align perfectly on a straight line *sloping downwards* as the x values increase 
- at +1 they align perfactly on a line *sloping upwards* as the x values increase
- as the coefficient goes from -1 to 0, the points get more scattered away from perfect alignment on a straightline until at 0 there is no pattern whatsoever
- as the correlation coefficient increases from 0 to +1, we see that the tendency to align on a straight line increases until perfect alignment at r = 1.

## Plotting a numerical variable against a categorical one

In this course, we will only assign a numerical variable to the y-axis. Thus, if a plot has a categorical variable, it will only occupy the x-axis.

Numerical and categorical variables differ in how they behave in plots. In @fig-advertising-sales-channel-1 we have the variable *advertising_spend_k* on the x-axis. Being a numerical variable, it can potentially take on any value on the x-axis. On the other hand, look at @fig-bank-account-type-balance. 

![Plotting a categorical variable against a numerical one -- using the data frame *acct_type_balance* (not plotted using the *point_plot* function)](../../images/fig-bank-account-type-balance.png){#fig-bank-account-type-balance width=70% fig-align="center"}


Here we have the variable *bank_account_type* on the x-axis and it can take on only one of two values *"Checking"* and *"Savings"*. Thios is why each of the rows in the data frame falls along one of two perfectly vertical assortment of points If the row corresponds to a "Checking" account, it falls on the left set of points and on the right set otherwise. 

### *point_plot* and "jittering"

If we have two *Checking* accounts with the same or very similar balance, their points will overlap. Because of this overplotting, the plot in @fig-bank-account-type-balance does not enable us to look at all the points.

To overcome this problem, the *point_plot* function plots this chart a bit differently. See @fig-account-type-balance-point-plot.

```{r}
#| echo: true
#| label: fig-account-type-balance-point-plot
#| fig-cap: "Plot of account type against account bakance using the *point_plot function*: it jitters the points along the x-axis to reduce overplotting "
acct_type_balance |> 
  point_plot(balance ~ bank_account_type)
```

To enable us to see the points more clearly, the *point_plot* function randomly "jitters" the points along the x-axis to more clearly separate points that might be overplotted or close together.

## Bringing a third variable into the plot

Two-dimensional plots can normally accommodate only two variables -- one on each axis. However, we can often get more insights if we manage to get more variables into our plots. The *point_plot* functions allows us to bring one more dimension to our plots through color.  

In @fig-advertising-sales-channel-1, we saw the positive relationship between *weekly_sales_k* and *advertising_spend_k* in the *advertising_sales_channel* data frame. That data frame has another variable *channel*. Each row corresponds to one of two sales channels -- *Search Ads* and *Retail Promo*. We might want to study separately for each channel the relationship between advertising spend and the weekly sales. 


```{r}
#| echo: true
#| error: true
#| label: fig-advertising-sales-channel-color
#| fig-cap: "We bring in  *channel* through color in the plot of *weekly_sales_k* against *advertising_spend_k* from the *advertising_sales_channel* data frame"

advertising_sales_channel |> 
  point_plot(weekly_sales_k ~ advertising_spend_k + channel)
```

@fig-advertising-sales-channel-color inserts, through color, the variable *channel* into the plot of *weekly_sales_k* against *advertising_spend_k* from the *advertising_sales_channel* data frame. From it we can clearly see that the points corresponding to each sales channel clearly shows the positive relationship that we saw earlier. But this plot also shows that for a given value of *advertising_spend_k* the *Retail Promo* channel generally has a comparatively higher *weekly_sales_k* value. Adding the variable *channel* through color enabled us to see more into the data than before.

### Understanding the tilde expression to add a third variable

@fig-color-tilde-expression shows the tilde expression we used in a point plot of two variables to color the points based on a third variable.

![To color the points based on the value of a third variable, we just *add* it to the end of the tilde-expression after a plus sign ](../../images/fig-color-tilde-expression.png){#fig-color-tilde-expression width=70% fig-align="center"}

@fig-color-tilde-expression-2 shows another example. In this, we use the *mpg* data frame which contains data on cars. We plot the city mileage of cars (variable *cty*) against their engine displacement (variable *displ*). We color each point based on the class of the vehicle (variable *class*).

```{r}
#| echo: true
#| error: true
#| label: fig-color-tilde-expression-2
#| fig-cap: "Using the *mpg* data frame: plotting the city mileage against displacement and coloring the points based on the class of a car"

mpg |> 
  point_plot(cty ~ displ + class)
```


